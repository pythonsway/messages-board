(this["webpackJsonpmy-app"]=this["webpackJsonpmy-app"]||[]).push([[0],{51:function(e,a,t){e.exports=t(69)},56:function(e,a,t){},69:function(e,a,t){"use strict";t.r(a);var n=t(0),r=t.n(n),c=t(36),s=t.n(c),l=t(16),i=(t(56),t(4)),o=t.n(i),m=t(17),u=t(6),d=t(18),p=t(46),g=t(47),b=t(49),h=t(10),E=t(27),f=t(37),v=t(9),N=Object(v.a)(),y=function(){return N.replace(window.location.pathname)},w=r.a.createContext(),k=function(){return Object(n.useContext)(w)},x=function(e){var a=e.children,t=e.path,c=Object(E.a)(e,["children","path"]),s=k(),i=s.loading,m=s.isAuthenticated,u=s.loginWithRedirect;return Object(n.useEffect)((function(){if(!i&&!m){o.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.a.awrap(u({appState:{targetUrl:window.location.pathname}}));case 2:case"end":return e.stop()}}))}}),[i,m,u,t]),r.a.createElement(l.b,Object.assign({path:t},c,{render:function(e){return m?a:r.a.createElement(l.a,{to:{pathname:"/login",state:{from:e.location}}})}}))},O=t(7),j=function(){var e=k(),a=e.isAuthenticated,t=e.loginWithRedirect,n=e.user,c=e.logout,s=r.a.createElement(r.a.Fragment,null,r.a.createElement("ul",{className:"navbar-nav ml-auto mt-2 mt-lg-0"},r.a.createElement("li",{className:"nav-item"},r.a.createElement(O.b,{to:"/messages/create",className:"nav-link",activeClassName:"active"},"Create Message")),r.a.createElement("li",{className:"nav-item dropdown"},r.a.createElement("a",{className:"nav-link dropdown-toggle font-italic",href:"/#",id:"navbarDropdownMenuLink",role:"button","data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false"},a&&n.nickname),r.a.createElement("div",{className:"dropdown-menu","aria-labelledby":"navbarDropdownMenuLink"},r.a.createElement(O.b,{to:"/external-api",className:"dropdown-item",activeClassName:"active"},"ExternalAPI"),r.a.createElement(O.b,{to:"/profile",className:"dropdown-item",activeClassName:"active"},"Profile"),r.a.createElement("div",{className:"dropdown-divider"}),r.a.createElement("button",{className:"dropdown-item",onClick:function(){return c()}},"Logout"))))),l=r.a.createElement("ul",{className:"navbar-nav ml-auto mt-2 mt-lg-0"},r.a.createElement("li",{className:"nav-item"},r.a.createElement("button",{onClick:function(){return t({})},className:"btn btn-secondary"},"Login")));return r.a.createElement("nav",{className:"navbar navbar-expand-sm navbar-dark bg-primary mb-5"},r.a.createElement("div",{className:"container"},r.a.createElement(O.b,{className:"navbar-brand",exact:!0,to:"/"},"Message Board"),r.a.createElement("button",{className:"navbar-toggler",type:"button","data-toggle":"collapse","data-target":"#navbarToggler","aria-controls":"navbarToggler","aria-expanded":"false","aria-label":"Toggle navigation"},r.a.createElement("span",{className:"navbar-toggler-icon"})),r.a.createElement("div",{className:"collapse navbar-collapse",id:"navbarToggler"},a?s:l)))},C=function(){return r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col text-center"},r.a.createElement("div",{className:"spinner-border m-5",role:"status"},r.a.createElement("span",{className:"sr-only"},"Loading..."))))},M=function(){return r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col text-center mt-5"},r.a.createElement("p",null," by ",r.a.createElement("a",{href:"https://pythonsway.it",target:"_blank",rel:"noopener noreferrer"},"Python's way"))))},P=function(){return r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col mx-auto"},r.a.createElement("div",{className:"card bg-light card-body mt-5"},r.a.createElement("h2",{className:"mb-4"},"Oops, something went wrong"),r.a.createElement("p",null,"No match for ",r.a.createElement("code",null,window.location.pathname))),r.a.createElement("div",{className:"m-4"},r.a.createElement(O.a,{className:"btn btn-outline-secondary",to:"/"},"Go home"))))},S=function(){var e=Object(n.useState)(!1),a=Object(h.a)(e,2),t=a[0],c=a[1],s=Object(n.useState)(""),l=Object(h.a)(s,2),i=l[0],m=l[1],u=k(),d=u.getTokenSilently,p=u.user;return r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col mx-auto"},r.a.createElement("div",{className:"card bg-light card-body mt-5"},r.a.createElement("h2",{className:"mb-4"},"External API"),r.a.createElement("div",{className:"card-body"},"Your profile"),r.a.createElement("ul",{className:"list-group list-group-flush"},r.a.createElement("li",{className:"list-group-item"},r.a.createElement("code",null,JSON.stringify(p,null,2)))),r.a.createElement("ul",{className:"list-group list-group-flush"},r.a.createElement("li",{className:"list-group-item"},r.a.createElement("button",{type:"button",className:"btn btn-outline-info",onClick:function(){var e,a,t;return o.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,o.a.awrap(d());case 3:return e=n.sent,n.next=6,o.a.awrap(fetch("/api/private",{headers:{Authorization:"Bearer ".concat(e)}}));case 6:return a=n.sent,n.next=9,o.a.awrap(a.json());case 9:t=n.sent,c(!0),m(t),n.next=17;break;case 14:n.prev=14,n.t0=n.catch(0),console.error(n.t0);case 17:case"end":return n.stop()}}),null,null,[[0,14]])}},"Ping API")),r.a.createElement("li",{className:"list-group-item"},t&&r.a.createElement("code",null,JSON.stringify(i,null,2)))))))},L=t(22),_=t(19),R=t(20),I=t.n(R),T=t(21),A=t(40),q=t(41),D=t(48),W=t(42),$=t(50),U=function(e){function a(){return Object(A.a)(this,a),Object(D.a)(this,Object(W.a)(a).apply(this,arguments))}return Object($.a)(a,e),Object(q.a)(a,[{key:"render",value:function(){return r.a.createElement("div",{className:"d-flex w-100 justify-content-between"},r.a.createElement(O.a,{to:"/messages/".concat(this.props.item.id),className:"list-group-item list-group-item-action"},r.a.createElement("blockquote",{className:"blockquote mb-0"},r.a.createElement("p",{className:"text-truncate"},this.props.item.message,r.a.createElement("span",{className:"blockquote-footer"},"by ",this.props.item.user.nick)))))}}]),a}(n.Component);function B(){var e=Object(_.a)(['\nquery ListViewSearch($search: String, $cursor: String) {\n  allMessages(orderBy: "-creation_date", first: 10, message_Icontains: $search, after: $cursor) @connection(key: "allMessages", filter: ["search"]){\n    totalCount\n    edges {\n      node {\n        id\n        message\n        user {\n          nick\n        }\n      }\n    }\n    pageInfo {\n      hasNextPage\n      hasPreviousPage\n      startCursor\n      endCursor\n    }\n  }\n}\n']);return B=function(){return e},e}var Q=I()(B()),J=function(){var e=new URLSearchParams(Object(l.g)().search),a=Object(n.useRef)(null),t=Object(T.b)(Q,{variables:{search:e.get("search")||""},errorPolicy:"all",fetchPolicy:"cache-and-network",notifyOnNetworkStatusChange:!0}),c=t.loading,s=t.error,i=t.data,o=t.fetchMore;return c||s?r.a.createElement(C,null):r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col"},r.a.createElement("h1",{className:"mb-4 text-center"},"Messages"))),r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col"},r.a.createElement("h2",{className:"mt-4 font-weight-light"},"Search:"),r.a.createElement("div",{className:"col-md-8 m-auto"},r.a.createElement("form",{className:"form-inline my-2 my-lg-0",onSubmit:function(e){e.preventDefault();var t="?search=".concat(a.current.value);N.push("/".concat(t))},onReset:function(e){e.preventDefault(),a.current.value="",N.push("/")}},r.a.createElement("input",{className:"form-control mr-sm-2 border-secondary",type:"search",ref:a}),r.a.createElement("div",{className:"btn-group",role:"group"},r.a.createElement("button",{className:"btn btn-outline-success my-2 my-sm-0",type:"submit"},"Go"),r.a.createElement("button",{className:"btn btn-outline-danger my-2 my-sm-0",type:"reset"},"Reset")))),r.a.createElement("h2",{className:"mt-4 font-weight-light"},"Feed:"),r.a.createElement("div",{className:"col-md-8 m-auto"},r.a.createElement("div",{className:"list-group"},i.allMessages.edges.map((function(e){return r.a.createElement(U,{key:e.node.id,item:e.node})}))),r.a.createElement("div",{className:"m-3"},i.allMessages.pageInfo.hasNextPage&&r.a.createElement("button",{onClick:function(){o({variables:{cursor:i.allMessages.pageInfo.endCursor},updateQuery:function(e,a){var t=a.fetchMoreResult,n=(a.variables,t.allMessages.edges),r=t.allMessages.pageInfo;return n.length?{allMessages:{__typename:e.allMessages.__typename,edges:[].concat(Object(L.a)(e.allMessages.edges),Object(L.a)(n)),pageInfo:r}}:e}})},className:"btn btn-outline-primary"},"Load more..."))))))};function F(){var e=Object(_.a)(["\nmutation CreateView($input: CreateMessageMutationInput!) {\n  createMessage(input: $input) {\n    message {\n      id\n      message\n    }\n  }\n}\n"]);return F=function(){return e},e}var V=I()(F()),z=function(){var e=k().user,a=Object(n.useRef)(null),t=Object(T.a)(V,{refetchQueries:["ListViewSearch"]}),c=Object(h.a)(t,2),s=c[0],l=c[1],i=l.loading,o=l.error,u=l.data;return i||o?r.a.createElement(C,null):r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-md-8 m-auto"},r.a.createElement("div",{className:"card bg-light card-body mt-5"},r.a.createElement("h2",{className:"text-center"},"Create Message"),r.a.createElement("form",{onSubmit:function(t){t.preventDefault(),s({variables:{input:{message:a.current.value,nick:e.nickname}},optimisticResponse:{__typename:"CreateMessageMutation",createMessage:{__typename:"CreateMessageMutationPayload",message:a.current.value,nick:e.nickname}},update:function(e,a){var t=a.data.createMessage,n=e.readQuery({query:Q}).allMessages,r={node:Object(m.a)({},t.message)};e.writeQuery({query:Q,data:Object(m.a)({},u,{allMessages:{edges:[].concat(Object(L.a)(n.edges),[r])}})})}}),a.current.value="",N.push("/")}},r.a.createElement("div",{className:"form-group"},r.a.createElement("label",null,"Message"),r.a.createElement("textarea",{required:!0,rows:"3",type:"text",className:"form-control form-control-lg",ref:a})),r.a.createElement("div",{className:"form-group"},r.a.createElement("button",{type:"submit",className:"btn btn-outline-primary"},"Add"))))))},G=function(e){return function(e,a){var t=e-a;return t<2e4?"just now":t<6e4?"less than 1 min ago":t<36e5?Math.round(t/6e4)+" min ago":t<864e5?Math.round(t/36e5)+" h ago":t<2592e6?Math.round(t/864e5)+" days ago":t<31536e6?Math.round(t/2592e6)+" mo ago":Math.round(t/31536e6)+" years ago"}((new Date).getTime(),new Date(e).getTime())};function K(){var e=Object(_.a)(["\nmutation createLike($input: CreateLikeMutationInput!) {\n  createLike(input: $input) {\n    likesNumber\n    message {\n      __typename\n      id\n      message\n      creationDate\n      likes {\n        totalCount\n        edges {\n          node {\n            id\n          }\n        }\n      }\n    }\n  }\n}\n"]);return K=function(){return e},e}function X(){var e=Object(_.a)(["\nquery DetailView($id: ID!) {\n  message(id: $id) {\n    __typename\n    id\n    message\n    creationDate\n    user {\n      nick\n    }\n    userLiked\n    likes {\n      totalCount\n      edges {\n        node {\n          id\n        }\n      }\n    }\n  }\n}\n"]);return X=function(){return e},e}var H=I()(X()),Y=I()(K()),Z=function(){var e=Object(l.h)().id,a=Object(T.b)(H,{variables:{id:e},errorPolicy:"all",fetchPolicy:"cache-and-network",notifyOnNetworkStatusChange:!0}),t=a.loading,n=a.error,c=a.data,s=Object(T.a)(Y),i=Object(h.a)(s,1)[0];return t||n?r.a.createElement(C,null):r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-md-8 m-auto"},r.a.createElement("div",{className:"card mb-3"},r.a.createElement("h2",{className:"card-header text-center"},"Meaasage"),r.a.createElement("div",{className:"card-body"},r.a.createElement("h3",{className:"card-title text-center"},'"'.concat(c.message.message,'"')),r.a.createElement("h4",{className:"card-subtitle text-muted"},r.a.createElement("span",{className:"font-weight-lighter"},"by: "),c.message.user.nick)),r.a.createElement("ul",{className:"list-group list-group-flush"},r.a.createElement("li",{className:"list-group-item"},"Likes: ",c.message.likes.totalCount),r.a.createElement("li",{className:"list-group-item"},r.a.createElement("button",{type:"button",className:"btn btn-primary",disabled:c.message.userLiked,onClick:function(a){var t=c.message.likes.totalCount+1;i({variables:{input:{messageId:c.message.id}},optimisticResponse:{__typename:"CreateLikeMutation",createLike:{__typename:"CreateLikeMutationPayload",likesNumber:t,message:c.message}},refetchQueries:[{query:H,variables:{id:e}}],update:function(a,t){var n=t.data.createLike,r={node:Object(m.a)({},n)};a.writeQuery({query:H,variables:{id:e},data:Object(m.a)({},c,{likes:{totalCount:n.likesNumber,edges:[].concat(Object(L.a)(c.message.likes.edges),[r])}})})}})}},c.message.userLiked?"Liked":"Like"))),r.a.createElement("div",{className:"card-footer text-muted"},G(c.message.creationDate)))))},ee=function(){var e=k(),a=e.loading,t=e.user;return a||!t?r.a.createElement(C,null):r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-md-8 m-auto"},r.a.createElement("div",{className:"card mb-3"},r.a.createElement("h2",{className:"card-header text-center"},"Profile"),r.a.createElement("div",{className:"card-body"},r.a.createElement("h3",{className:"card-title text-center"},t.name)),r.a.createElement("img",{src:t.picture,className:"mx-auto my-2 img-thumbnail",width:"120px",alt:"Profile"}),r.a.createElement("ul",{className:"list-group list-group-flush"},r.a.createElement("li",{className:"list-group-item"},r.a.createElement("span",{className:"font-weight-bolder"},"e-mail: "),t.email),r.a.createElement("li",{className:"list-group-item"},r.a.createElement("span",{className:"font-weight-bolder"},"nickname: "),t.nickname),r.a.createElement("li",{className:"list-group-item"},r.a.createElement("span",{className:"font-weight-bolder"},"updated: "),G(t.updated_at))))))},ae=function(){var e=k(),a=e.loading,t=e.isAuthenticated,c=e.loginWithRedirect;return Object(n.useEffect)((function(){t&&N.push("/")}),[t]),a?r.a.createElement(C,null):r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-md-6 m-auto"},r.a.createElement("div",{className:"card mb-3"},r.a.createElement("h2",{className:"card-header text-center"},"Login"),r.a.createElement("div",{className:"card-body"},r.a.createElement("h3",{className:"card-title text-center"})),r.a.createElement("button",{onClick:function(){return c({})},className:"btn btn-secondary"},"Login via Auth0"))))},te=function(){var e=k(),a=e.loading,t=e.getTokenSilently,n=e.isAuthenticated,c=new p.a({uri:"/gql",credentials:"same-origin"}),s=Object(b.a)((function(e,a){var r,c;return o.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=a.headers,!n){e.next=8;break}return e.next=4,o.a.awrap(t());case 4:return c=e.sent,e.abrupt("return",{headers:Object(m.a)({},r,{authorization:"Bearer ".concat(c)})});case 8:return e.abrupt("return",{headers:r});case 9:case"end":return e.stop()}}))})).concat(c),i=new g.a,h=new d.a({link:s,cache:i});return a?r.a.createElement(C,null):r.a.createElement(u.a,{client:h},r.a.createElement("div",{className:"App"},r.a.createElement(j,null),r.a.createElement("div",{className:"container"},r.a.createElement(l.d,null,r.a.createElement(l.b,{exact:!0,path:"/"},r.a.createElement(J,null)),r.a.createElement(l.b,{exact:!0,path:"/login"},r.a.createElement(ae,null)),r.a.createElement(x,{exact:!0,path:"/profile"},r.a.createElement(ee,null)),r.a.createElement(x,{exact:!0,path:"/external-api"},r.a.createElement(S,null)),r.a.createElement(x,{exact:!0,path:"/messages/create"},r.a.createElement(z,null)),r.a.createElement(x,{exact:!0,path:"/messages/:id"},r.a.createElement(Z,null)),r.a.createElement(l.a,{exact:!0,from:"/messages",to:"/"}),r.a.createElement(l.b,null,r.a.createElement(P,null))),r.a.createElement(M,null))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(r.a.createElement(l.c,{history:N},r.a.createElement((function(e){var a=e.children,t=e.onRedirectCallback,c=void 0===t?y:t,s=Object(E.a)(e,["children","onRedirectCallback"]),l=Object(n.useState)(),i=Object(h.a)(l,2),m=i[0],u=i[1],d=Object(n.useState)(),p=Object(h.a)(d,2),g=p[0],b=p[1],v=Object(n.useState)(),N=Object(h.a)(v,2),k=N[0],x=N[1],O=Object(n.useState)(!0),j=Object(h.a)(O,2),C=j[0],M=j[1],P=Object(n.useState)(!1),S=Object(h.a)(P,2),L=S[0],_=S[1];Object(n.useEffect)((function(){!function(){var e,a,t,n,r;o.a.async((function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,o.a.awrap(Object(f.a)(s));case 2:if(e=l.sent,x(e),!window.location.search.includes("code=")||!window.location.search.includes("state=")){l.next=10;break}return l.next=7,o.a.awrap(e.handleRedirectCallback());case 7:a=l.sent,t=a.appState,c(t);case 10:return l.next=12,o.a.awrap(e.isAuthenticated());case 12:if(n=l.sent,u(n),!n){l.next=19;break}return l.next=17,o.a.awrap(e.getUser());case 17:r=l.sent,b(r);case 19:M(!1);case 20:case"end":return l.stop()}}))}()}),[]);return r.a.createElement(w.Provider,{value:{isAuthenticated:m,user:g,loading:C,popupOpen:L,loginWithPopup:function(){var e,a,t=arguments;return o.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return e=t.length>0&&void 0!==t[0]?t[0]:{},_(!0),n.prev=2,n.next=5,o.a.awrap(k.loginWithPopup(e));case 5:n.next=10;break;case 7:n.prev=7,n.t0=n.catch(2),console.error(n.t0);case 10:return n.prev=10,_(!1),n.finish(10);case 13:return n.next=15,o.a.awrap(k.getUser());case 15:a=n.sent,b(a),u(!0);case 18:case"end":return n.stop()}}),null,null,[[2,7,10,13]])},handleRedirectCallback:function(){var e;return o.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return M(!0),a.next=3,o.a.awrap(k.handleRedirectCallback());case 3:return a.next=5,o.a.awrap(k.getUser());case 5:e=a.sent,M(!1),u(!0),b(e);case 9:case"end":return a.stop()}}))},getIdTokenClaims:function(){return k.getIdTokenClaims.apply(k,arguments)},loginWithRedirect:function(){return k.loginWithRedirect.apply(k,arguments)},getTokenSilently:function(){return k.getTokenSilently.apply(k,arguments)},getTokenWithPopup:function(){return k.getTokenWithPopup.apply(k,arguments)},logout:function(){return k.logout.apply(k,arguments)}}},a)}),{audience:"https://dj-react-1/api",domain:"dj-react-1.eu.auth0.com",client_id:"euyr4JPgTnqc2neNXeUKKggIe1HFwMXr",redirect_uri:window.location.origin,onRedirectCallback:function(e){N.push(e&&e.targetUrl?e.targetUrl:window.location.pathname)}},r.a.createElement(te,null))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[51,1,2]]]);
//# sourceMappingURL=main.091c3682.chunk.js.map